# craftr_module(maxon.c4d.resedit)

from craftr import session, path, platform
session.path.append(path.local('..'))
session.update()

from craftr.ext.maxon import c4d

defines = ['__C4D_64BIT']
if platform.name == 'Windows':
  defines += ['_WINDOWS']
elif platform.name == 'Darwin':
  defines += ['__MAC']
else:
  raise EnvironmentError('unsupported platform: {0}'.format(platform.name))

objects = c4d.objects(
  sources = path.glob('source/**/*.cpp'),
  include = [path.local('res')],
  defines = defines,
  clang_remove_flags = ['-Wmissing-prototypes', '-Wshadow'],
  clang_additional_flags = ['-Wno-deprecated-register'],
)

plugin = c4d.link(
  output = path.local('resedit-nrplugins-r{0}'.format(c4d.release)),
  inputs = objects,
  msvc_libs = ['User32'],
)
